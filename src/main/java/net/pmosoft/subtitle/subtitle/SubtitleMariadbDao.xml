<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="net.pmosoft.subtitle.subtitle.SubtitleDao">

<insert id="insertUsrSttlMstr" parameterType="net.pmosoft.subtitle.subtitle.UsrSttlVo">

    -- SubtitleDao.insertUsrSttlMstr
    INSERT INTO STTL.TSSCM00010
    (
         USR_ID          -- 사용자아이디    
        ,STTL_NM         -- 자막명      
        ,FSTTL_NM        -- 외국어자막명      
        ,MSTTL_NM        -- 모국어자막명      
        ,REG_DTM         -- 등록일시
        ,REG_USR_ID      -- 등록자
        ,UPD_DTM         -- 변경일시
        ,UPD_USR_ID      -- 변경자
    ) VALUES (
         #{usrId}        -- 사용자아이디    
        ,#{sttlNm}       -- 자막명      
        ,#{fsttlNm}      -- 외국어자막명      
        ,#{msttlNm}      -- 모국어자막명      
        ,now()       -- 등록일시
        ,#{regUsrId}     -- 등록자
        ,now()       -- 변경일시
        ,#{updUsrId}     -- 변경자
    )
</insert>

<insert id="insertUsrSttlDtl" parameterType="String">
    -- SubtitleDao.insertUsrSttlDtl
    INSERT INTO STTL.TSSCM00020
    (
         USR_ID          -- 사용자아이디    
        ,STTL_NM         -- 자막명      
        ,STTL_CD         -- 자막구분(1:외국어,2:모국어) 
        ,STTL_STM        -- 자막시작시각      
        ,STTL_ETM        -- 자막종료시각      
        ,STTL_DESC       -- 자막문장내용
        ,REG_DTM         -- 등록일시
        ,REG_USR_ID      -- 등록자
        ,UPD_DTM         -- 변경일시
        ,UPD_USR_ID      -- 변경자
    ) VALUES (
         #{usrId}        -- 사용자아이디    
        ,#{sttlNm}       -- 자막명      
        ,#{sttlCd}       -- 자막구분(1:외국어,2:모국어)  
        ,#{sttlStm}      -- 자막시작시각             
        ,#{sttlEtm}      -- 자막종료시각             
        ,#{sttlDesc}     -- 자막문장내용             
        ,now()           -- 등록일시
        ,#{regUsrId}     -- 등록자
        ,now()           -- 변경일시
        ,#{updUsrId}     -- 변경자
    )
      
</insert>


<insert id="insertUsrSttlDtlBulk" parameterType="String">

    -- SubtitleDao.insertUsrSttlDtl
    INSERT INTO STTL.TSSCM00020
    (
         USR_ID          -- 사용자아이디    
        ,STTL_NM         -- 자막명      
        ,STTL_CD         -- 자막구분(1:외국어,2:모국어) 
        ,STTL_STM        -- 자막시작시각      
        ,STTL_ETM        -- 자막종료시각      
        ,STTL_DESC       -- 자막문장내용
        ,REG_DTM         -- 등록일시
        ,REG_USR_ID      -- 등록자 
        ,UPD_DTM         -- 변경일시
        ,UPD_USR_ID      -- 변경자
    ) VALUES
	<foreach item="usrSttlVo" index="index" collection="list" open="" separator="," close="">
		(
         #{usrSttlVo.usrId}        -- 사용자아이디    
        ,#{usrSttlVo.sttlNm}       -- 자막명      
        ,#{usrSttlVo.sttlCd}       -- 자막구분(1:외국어,2:모국어)  
        ,#{usrSttlVo.sttlStm}      -- 자막시작시각             
        ,#{usrSttlVo.sttlEtm}      -- 자막종료시각             
        ,#{usrSttlVo.sttlDesc}     -- 자막문장내용             
        ,now()       -- 등록일시
        ,#{usrSttlVo.regUsrId}     -- 등록자
        ,now()       -- 변경일시
        ,#{usrSttlVo.updUsrId}     -- 변경자
        )
	</foreach>

      
</insert>


<insert id="insertTestBulk2" parameterType="String">

INSERT INTO STTL.TSSCM00020 VALUES 
('lifedomy@gmail.com','Silicon.Valley.S01E02.720p.HDTV.x264-2HD.smi'
,'2','1602830','1606670'
,'- Thank you.- Sorry. Ok.',now(),NULL,now(),NULL);

</insert>


<select id="selectUsrRecentlySttl" parameterType="String" resultType="net.pmosoft.subtitle.subtitle.UsrSttlVo">
    -- SubtitleDao.selectUsrRecentlySttl : 유저 최근 등록 자막
    SELECT DISTINCT
           A.USR_ID          -- 사용자아이디    
         , A.STTL_NM         -- 자막명      
         , A.STTL_CD         -- 자막구분(1:외국어,2:모국어) 
         , A.STTL_STM        -- 자막시작시각      
         , A.STTL_ETM        -- 자막종료시각      
         , A.STTL_DESC       -- 자막문장내용
         , A.REG_DTM AS REG_DTM
         , A.REG_USR_ID
         , A.UPD_DTM AS UPD_DTM
         , A.UPD_USR_ID
    FROM   STTL.TSSCM00020 A
    WHERE  A.USR_ID = #{usrId}
    AND    A.STTL_NM = (
                        SELECT MAX(STTL_NM) 
                        FROM   STTL.TSSCM00010 
                        WHERE  USR_ID = #{usrId}
                        AND    REG_DTM = (SELECT MAX(REG_DTM) 
                                          FROM STTL.TSSCM00010 
                                          WHERE USR_ID = #{usrId}
                                          ) 
                        )
    ORDER BY A.STTL_CD,CAST(STTL_STM AS INT), A.REG_DTM
</select>

<select id="selectUsrSttlMstrList" parameterType="net.pmosoft.subtitle.subtitle.UsrSttlVo" resultType="net.pmosoft.subtitle.subtitle.UsrSttlVo">
    -- SubtitleDao.selectUsrSttlMstrList : 유저자막목록
    SELECT A.USR_ID          -- 사용자아이디    
         , A.STTL_NM         -- 자막명      
         , A.FSTTL_NM        -- 외국어자막명      
         , A.MSTTL_NM        -- 모국어자막명      
         , DATE_FORMAT(A.REG_DTM,'%Y.%m.%d %H:%i:%S') AS REG_DTM
         , A.REG_USR_ID
         , DATE_FORMAT(A.UPD_DTM,'%Y.%m.%d %H:%i:%S') AS UPD_DTM
         , A.UPD_USR_ID
    FROM   STTL.TSSCM00010 A
    WHERE  A.USR_ID = #{usrId}
    ORDER BY A.REG_DTM
</select>

<select id="selectUsrSttlDtlList" parameterType="net.pmosoft.subtitle.subtitle.UsrSttlVo" resultType="net.pmosoft.subtitle.subtitle.UsrSttlVo">
    -- SubtitleDao.selectUsrSttlDtlList : 유저자막내용
    SELECT A.USR_ID          -- 사용자아이디    
         , A.STTL_NM         -- 자막명      
         , A.STTL_CD         -- 자막구분(1:외국어,2:모국어) 
         , A.STTL_STM        -- 자막시작시각      
         , A.STTL_ETM        -- 자막종료시각      
         , A.STTL_DESC       -- 자막문장내용
         , DATE_FORMAT(A.REG_DTM,'%Y.%m.%d %H:%i:%S') AS REG_DTM
         , A.REG_USR_ID
         , DATE_FORMAT(A.UPD_DTM,'%Y.%m.%d %H:%i:%S') AS UPD_DTM
         , A.UPD_USR_ID
    FROM   STTL.TSSCM00020 A
    WHERE  A.USR_ID = #{usrId}
    ORDER BY A.REG_DTM

</select>

<delete id="deleteUsrSttlMstr" parameterType="net.pmosoft.subtitle.subtitle.UsrSttlVo">
    -- SubtitleDao.deleteUsrSttlMstr
    DELETE FROM STTL.TSSCM00010 WHERE USR_ID = #{usrId} AND STTL_NM = #{sttlNm}
</delete> 

<delete id="deleteUsrSttlDtl" parameterType="net.pmosoft.subtitle.subtitle.UsrSttlVo">
    -- SubtitleDao.deleteUsrSttlDtl
    DELETE FROM STTL.TSSCM00020 WHERE USR_ID = #{usrId} AND STTL_NM = #{sttlNm}
</delete> 

</mapper>
